<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gallery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ["Space Grotesk", "sans-serif"],
                    },
                    colors: {
                        midnight: "#050b1a",
                        aurora: "#7cf5ff",
                        ember: "#FCB300",
                        slateglass: "rgba(15, 23, 42, 0.7)",
                    },
                    boxShadow: {
                        glow: "0 20px 60px rgba(8, 255, 214, 0.35)",
                    },
                },
            },
        };
    </script>
</head>

<body class="min-h-screen bg-black text-slate-100 font-display relative overflow-hidden">

    <header class="relative z-10 px-6 pt-8 lg:px-12">
        <div class="hidden pointer-events-none absolute inset-0">
            <div
                class="absolute -top-32 left-1/2 h-72 w-72 -translate-x-1/2 rounded-full bg-gradient-to-b from-aurora/50 to-aurora/80 blur-3xl opacity-70">
            </div>
        </div>
        <div class="mx-auto flex w-full max-w-6xl flex-col gap-8">
            <div class="flex flex-row items-center gap-4">
                <a href="{{ url_for('index') }}"
                    class="h-10 w-10 inline-flex items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm font-medium text-white transition hover:border-white/30">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" class="h-5 w-5 translate-x-[3px]"
                        fill="#fff" aria-hidden="true">
                        <path
                            d="m142-480 294 294q15 15 14.5 35T435-116q-15 15-35 15t-35-15L57-423q-12-12-18-27t-6-30q0-15 6-30t18-27l308-308q15-15 35.5-14.5T436-844q15 15 15 35t-15 35L142-480Z" />
                    </svg>
                </a>
                <div>
                    <h1 class="text-4xl font-semibold leading-tight tracking-tight text-white">Gallery</h1>
                </div>

            </div>
        </div>
    </header>

    <main class="relative z-10 px-6 pb-16 pt-6 lg:px-12">
        <section class="mx-auto flex w-full max-w-6xl flex-col gap-8">
            {% if gallery_items %}
            <div class="grid gap-3 sm:grid-cols-2 xl:grid-cols-3">
                {% for item in gallery_items %}
                <article class="rounded-2xl border border-white/10 bg-slateglass/80 backdrop-blur">
                    <div class="relative">
                        <button type="button" class="rounded-2xl group relative block w-full overflow-hidden" {% if
                            item.type in ['burst','timelapse'] %} data-burst-toggle="true"
                            data-target="{{ item.stack_id or ('stack-' ~ item.id) }}" aria-expanded="false" {% else %}
                            data-lightbox-trigger
                            data-lightbox-src="{{ url_for('serve_preview', filename=item.cover_path) }}"
                            data-lightbox-label="{{ item.timestamp_label }}" {% endif %}>
                            <div class="relative aspect-[4/3] overflow-hidden">
                                <img src="{{ url_for('serve_preview', filename=item.cover_path) }}"
                                    alt="Capture from {{ item.timestamp_label }}"
                                    class="h-full w-full object-cover transition duration-500 group-hover:scale-105 rounded-2xl" />
                                <div
                                    class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent">
                                </div>
                                {% if item.type == 'burst' %}
                                <div
                                    class="absolute top-4 right-4 inline-flex items-center gap-1 rounded-full bg-black/60 px-3 py-1 text-xs font-medium text-white">
                                    <span class="text-base"><svg xmlns="http://www.w3.org/2000/svg" height="16px"
                                            viewBox="0 -960 960 960" width="16px" fill="#fff">
                                            <path
                                                d="M480-411q-10 0-19.5-2.5T442-421L104-605q-11-6-15.5-15T84-640q0-11 4.5-20t15.5-15l338-184q9-5 18.5-7.5T480-869q10 0 19.5 2.5T518-859l338 184q11 6 15.5 15t4.5 20q0 11-4.5 20T856-605L518-421q-9 5-18.5 7.5T480-411Zm0-80 273-149-273-149-273 149 273 149Zm0-149Zm0 309 314-171q2-1 19-5 17 0 28.5 11.5T853-467q0 11-5 20t-16 15L518-261q-9 5-18.5 7.5T480-251q-10 0-19.5-2.5T442-261L128-432q-11-6-16-15t-5-20q0-17 11.5-28.5T147-507q5 0 9.5 1.5t9.5 3.5l314 171Zm0 160 314-171q2-1 19-5 17 0 28.5 11.5T853-307q0 11-5 20t-16 15L518-101q-9 5-18.5 7.5T480-91q-10 0-19.5-2.5T442-101L128-272q-11-6-16-15t-5-20q0-17 11.5-28.5T147-347q5 0 9.5 1.5t9.5 3.5l314 171Z" />
                                        </svg></span>
                                    <span>{{ item.count }}</span>
                                </div>
                                {%elif item.type == 'timelapse'%}
                                <div
                                    class="absolute top-4 right-4 inline-flex items-center gap-1 rounded-full bg-black/60 px-3 py-1 text-xs font-medium text-white">
                                    <span class="text-base"><svg xmlns="http://www.w3.org/2000/svg" height="16px"
                                            viewBox="0 -960 960 960" width="16px" fill="#fff">
                                            <path
                                                d="M610-760q-21 0-35.5-14.5T560-810q0-21 14.5-35.5T610-860q21 0 35.5 14.5T660-810q0 21-14.5 35.5T610-760Zm0 660q-21 0-35.5-14.5T560-150q0-21 14.5-35.5T610-200q21 0 35.5 14.5T660-150q0 21-14.5 35.5T610-100Zm160-520q-21 0-35.5-14.5T720-670q0-21 14.5-35.5T770-720q21 0 35.5 14.5T820-670q0 21-14.5 35.5T770-620Zm0 380q-21 0-35.5-14.5T720-290q0-21 14.5-35.5T770-340q21 0 35.5 14.5T820-290q0 21-14.5 35.5T770-240Zm60-190q-21 0-35.5-14.5T780-480q0-21 14.5-35.5T830-530q21 0 35.5 14.5T880-480q0 21-14.5 35.5T830-430ZM80-480q0-157 104.5-270T441-878q16-2 27.5 9.5T480-840q0 16-10.5 28T443-798q-121 14-202 104t-81 214q0 125 81 214.5T443-162q16 2 26.5 14t10.5 28q0 17-11.5 28.5T441-82Q288-97 184-210T80-480Zm400 80q-33 0-56.5-23.5T400-480q0-5 .5-10.5T403-501l-55-55q-11-11-11-28t11-28q11-11 28-11t28 11l55 55q4-1 21-3 33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Z" />
                                        </svg></span>
                                    <span>{{ item.count }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </button>
                    </div>

                </article>
                {% endfor %}
            </div>
            {% else %}
            <div class="min-h-[60vh] flex flex-col items-center justify-center text-center">
                <p class="my-2 text-2xl font-semibold text-slate-200">Nothing here yet</p>
                <p class="text-lg font-semibold text-slate-500">Connect your camera and take some photos!</p>

            </div>
            {% endif %}
        </section>
    </main>

    <div id="lightbox" class="fixed inset-0 z-50 hidden flex flex-col bg-black">
        <div class="absolute left-0 right-0 top-5 grid grid-cols-3 w-full items-center gap-4 px-5">
            <button type="button" id="lightbox-close"
                class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm font-medium text-white transition hover:border-white/30"
                aria-label="Close preview">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" class="h-5 w-5 translate-x-[3px]"
                    fill="#fff" aria-hidden="true">
                    <path
                        d="m142-480 294 294q15 15 14.5 35T435-116q-15 15-35 15t-35-15L57-423q-12-12-18-27t-6-30q0-15 6-30t18-27l308-308q15-15 35.5-14.5T436-844q15 15 15 35t-15 35L142-480Z" />
                </svg>
            </button>
            <p id="lightbox-caption" class="flex-1 text-center text-sm text-slate-300"></p>
            <button type="button" id="lightbox-more-options"
                class="justify-self-end inline-flex h-10 w-10 items-center justify-center rounded-full border border-white/10 bg-white/5 text-sm font-medium text-white transition hover:border-white/30"
                aria-label="Options">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#fff">
                    <path
                        d="M240-400q-33 0-56.5-23.5T160-480q0-33 23.5-56.5T240-560q33 0 56.5 23.5T320-480q0 33-23.5 56.5T240-400Zm240 0q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm240 0q-33 0-56.5-23.5T640-480q0-33 23.5-56.5T720-560q33 0 56.5 23.5T800-480q0 33-23.5 56.5T720-400Z" />
                </svg>
            </button>
        </div>
        <div class="flex flex-1 items-center justify-center">
            <img id="lightbox-image" src="" class="max-h-[70vh] w-full object-contain" />
        </div>
    </div>

    <script>
        const stackButtons = document.querySelectorAll("[data-burst-toggle]");
        stackButtons.forEach((button) => {
            button.addEventListener("click", () => {
                const targetId = button.getAttribute("data-target");
                if (!targetId) return;
                const target = document.getElementById(targetId);
                if (!target) return;

                const isOpen = !target.classList.contains("hidden");
                document.querySelectorAll("[data-stack-container]").forEach((container) => {
                    if (container.id === targetId) {
                        return;
                    }
                    container.classList.add("hidden");
                    const trigger = document.querySelector(`[data-target="${container.id}"]`);
                    trigger?.setAttribute("aria-expanded", "false");
                });

                if (isOpen) {
                    target.classList.add("hidden");
                    button.setAttribute("aria-expanded", "false");
                } else {
                    target.classList.remove("hidden");
                    button.setAttribute("aria-expanded", "true");
                    button.blur();
                }
            });
        });

        const lightbox = document.getElementById("lightbox");
        const lightboxImage = document.getElementById("lightbox-image");
        const lightboxCaption = document.getElementById("lightbox-caption");
        const closeLightboxButton = document.getElementById("lightbox-close");

        function closeLightbox() {
            lightbox.classList.add("hidden");
            lightboxImage.src = "";
            document.body.classList.remove("overflow-hidden");
        }

        function openLightbox(src, label) {
            if (!src) return;
            lightboxImage.src = src;
            lightboxImage.alt = label || "Captured frame";
            lightboxCaption.textContent = label || "";
            lightbox.classList.remove("hidden");
            document.body.classList.add("overflow-hidden");
        }

        document.querySelectorAll("[data-lightbox-trigger]").forEach((trigger) => {
            trigger.addEventListener("click", () => {
                const src = trigger.getAttribute("data-lightbox-src");
                const label = trigger.getAttribute("data-lightbox-label") || "";
                openLightbox(src, label);
            });
        });

        closeLightboxButton.addEventListener("click", closeLightbox);
        lightbox.addEventListener("click", (event) => {
            if (event.target === lightbox) {
                closeLightbox();
            }
        });
        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape" && !lightbox.classList.contains("hidden")) {
                closeLightbox();
            }
        });
        closeLightbox();
    </script>
</body>

</html>